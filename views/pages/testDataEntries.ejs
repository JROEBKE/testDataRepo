<!-- theme for table -->

<link href="/css/theme.bootstrap.css" rel="stylesheet">

<!-- load jQuery and tablesorter scripts for sorting table -->
<script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.tablesorter.js"></script>
<script type="text/javascript" src="/js/jquery.tablesorter.widgets.js"></script>


<!-- pager plugin -->
<link href="/css/jquery.tablesorter.pager.css" rel="stylesheet">
<script src="/js/jquery.tablesorter.pager.js" type="text/javascript"></script>

<!-- Output plugin / widget https://mottie.github.io/tablesorter/docs/example-widget-output.html -->
<script src="/js/parsers/parser-input-select.js"></script>
<script src="/js/widgets/widget-output.js"></script>


<!-- script for configuration of tablesorter MIT / GPL http://tablesorter.com/docs/ -->
<script>
$(document).ready(function() {

  var $table = $('table');

  $('.download').click(function(){
        $table.trigger('outputTable');
  })

  $("table").tablesorter({

    theme : "bootstrap",

    widthFixed: true,

    headerTemplate : '{content} {icon}',

    widgets : [ "uitheme", "filter", "columns", "zebra", "output"],

    widgetOptions : {

      zebra : ["even", "odd"],

      columns: [ "primary", "secondary", "tertiary" ],

      filter_reset : ".reset",

      filter_cssFilter: "form-control",

      filter_filteredRow   : 'filtered', //neu

      output_separator     : ',',         // ',' 'json', 'array' or separator (e.g. ';')
      output_ignoreColumns : [6],         // columns to ignore [0, 1,... ] (zero-based index)
      output_hiddenColumns : true,       // include hidden columns in the output
      output_includeFooter : false,        // include footer rows in the output
      output_includeHeader : true,        // include header rows in the output
      output_headerRows    : false,       // output all header rows (if multiple rows)
      output_dataAttrib    : 'data-name', // data-attribute containing alternate cell text
      output_delivery      : 'd',         // (p)opup, (d)ownload
      output_saveRows      : 'f',         // (a)ll, (v)isible, (f)iltered, jQuery filter selector (string only) or filter function
      output_duplicateSpans: true,        // duplicate output data in tbody colspan/rowspan
      output_replaceQuote  : '\u201c;',   // change quote to left double quote
      output_includeHTML   : true,        // output includes all cell HTML (except the header cells)
      output_trimSpaces    : false,       // remove extra white-space characters from beginning & end
      output_wrapQuotes    : false,       // wrap every cell output in quotes
      output_popupStyle    : 'width=580,height=310',
      output_saveFileName  : 'testDataExport.csv',
      // callbackJSON used when outputting JSON & any header cells has a colspan - unique names required
      output_callbackJSON  : function($cell, txt, cellIndex) {
        return txt + '(' + cellIndex + ')';
      },
      // callback executed when processing completes
      output_callback      : function(config, data, url) {
        // return false to stop delivery & do something else with the data
        // return true OR modified data (v2.25.1) to continue download/output
        return true;
      },

      // the need to modify this for Excel no longer exists
      output_encoding      : 'data:application/octet-stream;charset=utf8,',
      // override internal save file code and use an external plugin such as
      // https://github.com/eligrey/FileSaver.js
      output_savePlugin    : null /* function(config, widgetOptions, data) {
        var blob = new Blob([data], {type: widgetOptions.output_encoding});
        saveAs(blob, widgetOptions.output_saveFileName);
      } */
    }
  })

  .tablesorterPager({

    // target the pager markup - see the HTML block below
    container: $(".ts-pager"),

    // target the pager page select dropdown - choose a page
    cssGoto  : ".pagenum",

    // remove rows from the table to speed up the sort of large tables.
    // setting this to false, only hides the non-visible rows; needed if you plan to add/remove rows with the pager enabled.
    removeRows: false,

    // output string - default is '{page}/{totalPages}';
    // possible variables: {page}, {totalPages}, {filteredPages}, {startRow}, {endRow}, {filteredRows} and {totalRows}
    output: '{startRow} - {endRow} / {filteredRows} ({totalRows})'

  });

});
</script>

<div class="container">
  <div class="jumbotron text-center">
    <h1>Test data repository</h1>
  </div>
</div>

<% if (success.length > 0) { %>
    <div class="alert alert-success"><%= success %></div>
<% } %>


<div class="btn-group">
  <button type="button" class="btn btn-default reset">Reset</button> <!-- targeted by the "filter_reset" option -->
  <button type="button" class="btn btn-default download">Download CSV</button>
</div>
<!-- Pager alignement does not work properly somehow top style -->

<table id="table" class="tablesorter table-responsive">
    <thead>
        <tr>
            <th>Email</th>
            <th>Password</th>
            <th>Description</th>
            <th>Stages</th>
            <th>Tags</th>
            <th class="sorter-false filter-false">Actions</th>
        </tr>
    </thead>
    <tbody>

          <% for (var testDataEntry of testDataEntries) { %>

            <tr>
                <td><%= testDataEntry.email %></td>
                <td><%= testDataEntry.password %></td>
                <td><%= testDataEntry.description %></td>
                <td><%= testDataEntry.stages %></td>
                <td><%= testDataEntry.tags %></td>
                <td>
                    <a href="/testDataEntries/<%= testDataEntry.slug %>/edit" class="btn btn-sm btn-primary">Edit</a>
                    <a href="/testDataEntries/<%= testDataEntry.slug %>/delete" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
        <% } %>
    </tbody>
    <tfoot>
      <tr>
        <th>Email</th>
        <th>Password</th>
        <th>Description</th>
        <th>Stages</th>
        <th>Tags</th>
        <th>Actions</th>
      </tr>
      <tr>
        <!-- pager works not properly-->
        <th colspan="7" class="ts-pager form-inline" position="relative">
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-default first"><span class="glyphicon glyphicon-step-backward"></span></button>
            <button type="button" class="btn btn-default prev"><span class="glyphicon glyphicon-backward"></span></button>
          </div>
          <span class="pagedisplay"></span>
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-default next"><span class="glyphicon glyphicon-forward"></span></button>
            <button type="button" class="btn btn-default last"><span class="glyphicon glyphicon-step-forward"></span></button>
          </div>
        <select class="form-control input-sm pagesize" title="Select page size">
          <option selected="selected" value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="250">250</option>
        </select>
        </th>
      </tr>
    </tfoot>
</table>
